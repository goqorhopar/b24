# Команды для развертывания бота на сервере

# 1. Подключение к серверу
ssh root@109.172.47.253

# 2. Создание директории
mkdir -p /opt/meeting-bot
cd /opt/meeting-bot

# 3. Остановка старого бота
systemctl stop meeting-bot.service 2>/dev/null || true

# 4. Создание виртуального окружения
python3 -m venv venv
source venv/bin/activate

# 5. Установка зависимостей
pip install python-telegram-bot==21.6
pip install selenium>=4.15.0
pip install faster-whisper>=1.0.0
pip install pydub>=0.25.1
pip install speechrecognition>=3.10.0
pip install PyGithub>=1.59.0
pip install python-dotenv>=1.0.0
pip install playwright>=1.48.0

# 6. Установка браузеров
playwright install chromium

# 7. Установка системных зависимостей
apt-get update
apt-get install -y ffmpeg pulseaudio chromium-browser

# 8. Создание пользователя bot
useradd -m -s /bin/bash bot || true
usermod -a -G audio bot

# 9. Копирование файлов
# (скопировать файлы с локальной машины)

# 10. Настройка прав
chown -R bot:bot /opt/meeting-bot
chmod +x /opt/meeting-bot/meeting-bot-main.py

# 11. Создание systemd сервиса
cat > /etc/systemd/system/meeting-bot.service << 'EOF'
[Unit]
Description=Meeting Bot
After=network.target

[Service]
Type=simple
User=bot
Group=bot
WorkingDirectory=/opt/meeting-bot
EnvironmentFile=/opt/meeting-bot/.env
ExecStart=/opt/meeting-bot/venv/bin/python /opt/meeting-bot/meeting-bot-main.py
Restart=always
RestartSec=10
StandardOutput=journal
StandardError=journal

[Install]
WantedBy=multi-user.target
EOF

# 12. Запуск сервиса
systemctl daemon-reload
systemctl enable meeting-bot.service
systemctl start meeting-bot.service

# 13. Проверка статуса
systemctl status meeting-bot.service

# 14. Просмотр логов
journalctl -u meeting-bot.service -f
